{% extends "base.html" %}
{% load url from future %}
{% load tickets_time %}

{% block breadcrums %}
    <li><a href="{% url 'projects-all' %}">Projects</a></li>
    <li><a href="{% url 'projects-detail' project.pk %}">{{ project.name }}</a></li>
    <li>{{ ticket.title }}</li>
{% endblock %}

{% block content %}

<h2>#{{ ticket.pk }}: {{ ticket.title }} 
<a href="{% url 'tickets-edit' ticket.pk %}" class="button">Edit</a>
</h2>

<div class="ticket-wrapper">
    <div class="ticket">
        <div class="ticket-info">
            <ul>
                <li><strong>Priority:</strong> {{ ticket.priority }}</li>
                <li><strong>Status:</strong> {{ ticket.status }}</li>
                <li><strong>Assigned To:</strong> {{ ticket.assigned_to }}</li>
                <li><strong>Created:</strong> {{ ticket.created_on }} by {{ ticket.created_by }}</li>
            </ul>
            <div class="clear"></div>
        </div>
        <div class="ticket-body">
            {{ ticket.body|safe }}
        </div>
        <div class="ticket-info ticket-status">
            <ul>
                <li><strong>Estimated Time:</strong> {{ ticket.estimated_time|tickettime }}</li>
                <li><strong>Current Time:</strong> {{ times.total|tickettime }} ({{ times.billable|tickettime }} billable)</li>
            </ul>
            <div class="clear"></div>
        </div>
    </div>

    <h3>Comments</h3>
    <div class="ticket-comments">
        {% for comment in comments %}
            <div class="ticket">
                <div class="comment-info">
                    <ul>
                        <li><strong>Author:</strong> {{ comment.created_by }}</li>
                        <li><strong>Created On:</strong> {{ comment.created_on }}</li>
                        <li><a href="{% url 'comments-edit' comment.pk %}" class="button">Edit</a></li>
                    </ul>
                    <div class="clear"></div>
                </div>
                <div class="ticket-body">
                    {{ comment.body|safe }}
                </div>
            </div>
        {% endfor %}
    </div>

    <div class="ticket-add-comment">
        <form method="post" action="">
            <input type="hidden" name="form_type" value="comment_form" />
            {% csrf_token %}
            <h4>Add Comment</h4>
            {{ comment_form.body.errors }}
            {{ comment_form.body }}
            <input type="submit" name="submit" value="Add" class="submit" />
        </form>
    </div>
</div>

<div class="ticket-sidebar">
    <div class="timer-wrapper">
        <h3>Add Work <a class="timer-clock-control button" href="#" id="timer-clock">start clock</a></h3>
        <form id="work-form" action="" method="post">
            {% if work_form.errors %}
                <p class="error">
                {% for field in work_form %}
                    {% if field.errors %}
                        {% for error in field.errors %}
                            {{ error }}
                        {% endfor %}
                    {% endif %}
                {% endfor %}
                </p>
            {% endif %}
            <input type="hidden" name="form_type" value="work_form" />
            {% csrf_token %}
            {{ work_form.time }}
            {{ work_form.description }}
            <label class="billable">{{ work_form.billable }} Billable</label>
            {{ work_form.type }}
            <input type="submit" name="submit" value="Add" class="inline" />
        </form>
    </div>

    <div class="work-wrapper">
        <h3>Work Log</h3>
        <table class="work-log">
        {% for w in work %}
            <tr class="{% cycle 'odd' 'even' %}">
                <th>{{ w.created_by }} <a href="{% url 'work-edit' w.pk %}" class="button">Edit</a></th>
                <th class="center">
                    {% if w.billable %}
                        {% if 'basic' in w.type|lower %}$
                        {% elif 'normal' in w.type|lower %}$$
                        {% elif 'advanced' in w.type|lower %}$$$
                        {% else %}:(
                        {% endif %}
                    {% else %}
                    -
                    {% endif %}
                </th>
                <th>{{ w.time|tickettime }}</th>
            </tr>
            <tr class="{% cycle 'odd' 'even' %}">
                <td colspan="3">{{ w.description }}</td>
            </tr>
        {% endfor %}
        </table>
    </div>
</div>

<script type="text/javascript" src="{{ STATIC_URL }}js/tickets_detail.js"></script>

{% endblock %}

